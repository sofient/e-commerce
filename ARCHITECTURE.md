# ğŸ—ï¸ Architecture [STRANGERTHINGS] E-boutique

## ğŸ“Š Vue d'ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UTILISATEUR                              â”‚
â”‚                  (Navigateur Web)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚
        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND   â”‚         â”‚   SNIPCART   â”‚
â”‚              â”‚         â”‚              â”‚
â”‚  Index.html  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Panier +    â”‚
â”‚  site.css    â”‚         â”‚  Checkout    â”‚
â”‚  site.js     â”‚         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚ API REST               â”‚ Webhooks
       â”‚                        â”‚
       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKEND API                  â”‚
â”‚         (Node.js/Express)              â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Routes & Controllers            â”‚ â”‚
â”‚  â”‚  - Auth (JWT)                    â”‚ â”‚
â”‚  â”‚  - Products (CRUD)               â”‚ â”‚
â”‚  â”‚  - Orders (Gestion)              â”‚ â”‚
â”‚  â”‚  - Snipcart (Webhooks)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Middleware                      â”‚ â”‚
â”‚  â”‚  - Security (Helmet, CORS)       â”‚ â”‚
â”‚  â”‚  - Rate Limiting                 â”‚ â”‚
â”‚  â”‚  - JWT Verification              â”‚ â”‚
â”‚  â”‚  - MongoDB Sanitization          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Services & Utils                â”‚ â”‚
â”‚  â”‚  - Logger (Winston)              â”‚ â”‚
â”‚  â”‚  - Email (Nodemailer)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MONGODB    â”‚   â”‚    REDIS     â”‚
â”‚              â”‚   â”‚              â”‚
â”‚  - users     â”‚   â”‚  - Sessions  â”‚
â”‚  - products  â”‚   â”‚  - Cache     â”‚
â”‚  - orders    â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Structure des fichiers

```
cercle-ecommerce/
â”‚
â”œâ”€â”€ ğŸ“„ Index.html                    # Page principale (frontend)
â”œâ”€â”€ ğŸ“„ about.html                    # Page "Qui sommes-nous"
â”œâ”€â”€ ğŸ“„ faq.html                      # Page FAQ
â”œâ”€â”€ ğŸ“„ privacy.html                  # Politique de confidentialitÃ©
â”œâ”€â”€ ğŸ“„ pack-01.html ... pack-10.html # Pages dÃ©tails produits
â”‚
â”œâ”€â”€ ğŸ“ css/
â”‚   â””â”€â”€ site.css                     # Styles Apple-inspired
â”‚
â”œâ”€â”€ ğŸ“ js/
â”‚   â””â”€â”€ site.js                      # Scripts frontend
â”‚
â”œâ”€â”€ ğŸ“ backend/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ package.json              # DÃ©pendances Node.js
â”‚   â”œâ”€â”€ ğŸ“„ .env.example              # Template configuration
â”‚   â”œâ”€â”€ ğŸ“„ Dockerfile                # Image Docker backend
â”‚   â”œâ”€â”€ ğŸ“„ .gitignore
â”‚   â”œâ”€â”€ ğŸ“„ README.md                 # Doc API
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“„ server.js             # Point d'entrÃ©e Express
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ config/
â”‚       â”‚   â””â”€â”€ database.js          # Connexion MongoDB
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ models/
â”‚       â”‚   â”œâ”€â”€ User.js              # SchÃ©ma utilisateur
â”‚       â”‚   â”œâ”€â”€ Product.js           # SchÃ©ma produit
â”‚       â”‚   â””â”€â”€ Order.js             # SchÃ©ma commande
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ controllers/
â”‚       â”‚   â””â”€â”€ authController.js    # Logique authentification
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ routes/
â”‚       â”‚   â”œâ”€â”€ auth.js              # Routes auth
â”‚       â”‚   â”œâ”€â”€ products.js          # Routes produits
â”‚       â”‚   â”œâ”€â”€ orders.js            # Routes commandes
â”‚       â”‚   â””â”€â”€ snipcart.js          # Routes webhooks
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ middleware/
â”‚       â”‚   â”œâ”€â”€ auth.js              # VÃ©rification JWT
â”‚       â”‚   â””â”€â”€ security.js          # Helmet, CORS, etc.
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ services/
â”‚       â”‚   â””â”€â”€ (futurs services)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ utils/
â”‚       â”‚   â””â”€â”€ logger.js            # Winston logger
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ scripts/
â”‚           â””â”€â”€ seed.js              # Alimenter DB
â”‚
â”œâ”€â”€ ğŸ“„ docker-compose.yml            # Orchestration Docker
â”œâ”€â”€ ğŸ“„ .gitignore                    # Fichiers Ã  ignorer
â”‚
â”œâ”€â”€ ğŸ“„ README.md                     # Doc principale
â”œâ”€â”€ ğŸ“„ GETTING_STARTED.md            # Guide dÃ©marrage
â”œâ”€â”€ ğŸ“„ TEST_SCENARIO.md              # ScÃ©narios de test
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md               # Ce fichier
â””â”€â”€ ğŸ“„ PROJECT_INFO.md               # Infos projet

```

---

## ğŸ”„ Flux de donnÃ©es

### 1. Parcours Achat (Snipcart)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utilisateur â”‚
â”‚ clique      â”‚
â”‚ "Ajouter au â”‚
â”‚  panier"    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snipcart modal s'ouvre                  â”‚
â”‚ - RÃ©cupÃ¨re infos produit depuis        â”‚
â”‚   data-item-* attributes                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (optionnel: validation)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snipcart appelle:                       â”‚
â”‚ GET /api/v1/snipcart/products/{id}      â”‚
â”‚                                         â”‚
â”‚ Backend valide:                         â”‚
â”‚ - Prix correct                          â”‚
â”‚ - Stock disponible                      â”‚
â”‚ - Retourne infos Ã  jour                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utilisateur remplit formulaire:        â”‚
â”‚ - Email, nom                            â”‚
â”‚ - Adresse livraison                     â”‚
â”‚ - Champs custom (sexe, message)        â”‚
â”‚ - Carte bancaire (Stripe)              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snipcart calcule frais livraison       â”‚
â”‚                                         â”‚
â”‚ POST /api/v1/snipcart/webhooks          â”‚
â”‚ Event: shippingrates.fetch              â”‚
â”‚                                         â”‚
â”‚ Backend retourne:                       â”‚
â”‚ - Livraison standard (gratuit si >50â‚¬) â”‚
â”‚ - Livraison express (12.90â‚¬)           â”‚
â”‚ - Point relais (3.90â‚¬)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Paiement Stripe                         â”‚
â”‚ - Tokenization carte                    â”‚
â”‚ - Paiement sÃ©curisÃ©                     â”‚
â”‚ - Success!                              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snipcart envoie webhook:               â”‚
â”‚                                         â”‚
â”‚ POST /api/v1/snipcart/webhooks          â”‚
â”‚ Event: order.completed                  â”‚
â”‚                                         â”‚
â”‚ Payload: {                              â”‚
â”‚   invoiceNumber: "ORD-2026-000123"     â”‚
â”‚   items: [...],                         â”‚
â”‚   total: 89.97,                         â”‚
â”‚   email: "client@example.com"           â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend traite webhook:                â”‚
â”‚                                         â”‚
â”‚ 1. CrÃ©er Order en MongoDB               â”‚
â”‚ 2. DÃ©crÃ©menter stock produits           â”‚
â”‚ 3. Calculer donation (15%)              â”‚
â”‚ 4. Logger l'Ã©vÃ©nement                   â”‚
â”‚ 5. (Futur) Envoyer email confirmation   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Confirmation affichÃ©e Ã  l'utilisateur   â”‚
â”‚ - NumÃ©ro commande                       â”‚
â”‚ - Email reÃ§u                            â”‚
â”‚ - Tracking URL (si dispo)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Parcours Authentification (JWT)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Utilisateur â”‚
â”‚ clique      â”‚
â”‚ "S'inscrire"â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/v1/auth/register              â”‚
â”‚                                         â”‚
â”‚ Body: {                                 â”‚
â”‚   email: "user@example.com",            â”‚
â”‚   password: "SecurePass123!",           â”‚
â”‚   firstName: "John",                    â”‚
â”‚   lastName: "Doe"                       â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ authController.register()               â”‚
â”‚                                         â”‚
â”‚ 1. VÃ©rifier si email existe             â”‚
â”‚ 2. CrÃ©er User                           â”‚
â”‚ 3. Hash password (bcrypt, 10 rounds)    â”‚
â”‚ 4. Sauvegarder en MongoDB               â”‚
â”‚ 5. GÃ©nÃ©rer JWT tokens:                  â”‚
â”‚    - accessToken (15min)                â”‚
â”‚    - refreshToken (7 jours)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 201 Created:                   â”‚
â”‚                                         â”‚
â”‚ {                                       â”‚
â”‚   success: true,                        â”‚
â”‚   data: {                               â”‚
â”‚     user: {...},                        â”‚
â”‚     accessToken: "eyJhbG...",           â”‚
â”‚     refreshToken: "eyJhbG..."           â”‚
â”‚   }                                     â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend stocke tokens:                 â”‚
â”‚ - accessToken: localStorage/memory      â”‚
â”‚ - refreshToken: localStorage            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RequÃªtes API authentifiÃ©es:             â”‚
â”‚                                         â”‚
â”‚ Headers: {                              â”‚
â”‚   Authorization: "Bearer eyJhbG..."     â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware auth.verifyToken()           â”‚
â”‚                                         â”‚
â”‚ 1. Extraire token du header             â”‚
â”‚ 2. VÃ©rifier signature JWT               â”‚
â”‚ 3. VÃ©rifier expiration                  â”‚
â”‚ 4. VÃ©rifier user existe et actif        â”‚
â”‚ 5. Attacher req.userId, req.userRole    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller exÃ©cute action               â”‚
â”‚ - AccÃ¨s aux donnÃ©es user                â”‚
â”‚ - VÃ©rifications permissions             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ SchÃ©mas de donnÃ©es

### User Schema

```javascript
{
  _id: ObjectId,
  email: String (unique, required),
  passwordHash: String (hashed, not returned),
  firstName: String,
  lastName: String,
  phone: String,
  sexe: "Homme" | "Femme",

  addresses: [{
    type: "billing" | "shipping",
    street: String,
    city: String,
    postalCode: String,
    country: String,
    isPrimary: Boolean
  }],

  role: "user" | "admin" | "moderator",
  permissions: [String],

  refreshTokens: [{
    token: String,
    expiresAt: Date
  }],

  isVerified: Boolean,
  lastLogin: Date,
  isActive: Boolean,

  createdAt: Date,
  updatedAt: Date
}
```

### Product Schema

```javascript
{
  _id: ObjectId,
  sku: String (unique, "PACK-01"),
  name: String,
  slug: String (unique, "pack-01-enfant-garcon"),
  description: String (long),
  shortDescription: String,

  price: Number,
  discountPrice: Number,
  discountPercentage: Number (auto-calculated),

  stock: Number,
  lowStockThreshold: Number (default: 5),
  isAvailable: Boolean,

  images: [{
    url: String,
    altText: String,
    isPrimary: Boolean
  }],

  category: "enfant-garcon" | "enfant-fille" | ...,
  tags: [String],

  weight: Number (grammes),
  dimensions: { length, width, height },

  averageRating: Number,
  reviewCount: Number,

  donationEnabled: Boolean (default: true),
  donationPercentage: Number (default: 15),

  isActive: Boolean,
  isFeatured: Boolean,
  viewCount: Number,
  soldCount: Number,

  createdAt: Date,
  updatedAt: Date
}
```

### Order Schema

```javascript
{
  _id: ObjectId,
  orderNumber: String (unique, "ORD-2026-000123"),
  userId: ObjectId (ref User, optional),
  guestEmail: String,
  guestName: String,

  items: [{
    productId: ObjectId (ref Product),
    sku: String,
    name: String,
    price: Number,
    quantity: Number,
    subtotal: Number
  }],

  subtotal: Number,
  tax: Number,
  taxRate: Number (default: 20),
  shippingCost: Number,
  discount: Number,
  total: Number,
  donationAmount: Number (15% du subtotal),

  couponCode: String,

  shippingAddress: {
    fullName, street, city,
    postalCode, country, phone
  },

  billingAddress: { ... },

  paymentMethod: "card" | "paypal" | "snipcart",
  paymentProvider: "stripe" | "paypal" | "snipcart",
  paymentStatus: "pending" | "completed" | "failed" | ...,
  transactionId: String,

  orderStatus: "pending" | "confirmed" | "shipped" | ...,
  statusHistory: [{
    status: String,
    date: Date,
    note: String,
    updatedBy: ObjectId
  }],

  shippingCarrier: "colissimo" | "chronopost" | ...,
  trackingNumber: String,
  estimatedDelivery: Date,

  customerNotes: String,
  internalNotes: String,

  createdAt: Date,
  updatedAt: Date
}
```

---

## ğŸ” SÃ©curitÃ© - Couches de protection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. HTTPS/TLS (Production)                 â”‚
â”‚  â””â”€ Force HTTPS redirect                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CORS                                   â”‚
â”‚  â””â”€ Whitelist origins                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Helmet                                 â”‚
â”‚  â””â”€ Security headers (CSP, X-Frame, etc.)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Rate Limiting                          â”‚
â”‚  â”œâ”€ Global: 100 req/15min                  â”‚
â”‚  â””â”€ Auth: 5 req/15min (anti brute-force)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Input Validation                       â”‚
â”‚  â””â”€ Express-validator                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. MongoDB Sanitization                   â”‚
â”‚  â””â”€ PrÃ©vention NoSQL injection             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. JWT Verification                       â”‚
â”‚  â”œâ”€ Signature check                        â”‚
â”‚  â”œâ”€ Expiration check                       â”‚
â”‚  â””â”€ User active check                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. Role-Based Access Control (RBAC)       â”‚
â”‚  â””â”€ requireAdmin, requireRole              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Controller   â”‚
        â”‚   + Service    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ DÃ©ploiement - Architecture Production

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               CLOUDFLARE CDN                      â”‚
â”‚  - HTTPS/TLS                                      â”‚
â”‚  - DDoS Protection                                â”‚
â”‚  - Caching statique                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VERCEL     â”‚        â”‚   RAILWAY    â”‚
â”‚   (Frontend) â”‚        â”‚   (Backend)  â”‚
â”‚              â”‚        â”‚              â”‚
â”‚  - Index.htmlâ”‚        â”‚  - Node.js   â”‚
â”‚  - Static    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤  - Express   â”‚
â”‚    assets    â”‚  API   â”‚  - Docker    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  REST  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                         â”‚
                  â–¼                         â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ MONGODB      â”‚          â”‚  REDIS       â”‚
          â”‚ ATLAS        â”‚          â”‚  CLOUD       â”‚
          â”‚              â”‚          â”‚              â”‚
          â”‚ - M0 Free    â”‚          â”‚ - Cache      â”‚
          â”‚ - Replica    â”‚          â”‚ - Sessions   â”‚
          â”‚   Set        â”‚          â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Monitoring & ObservabilitÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLICATION                            â”‚
â”‚  â””â”€ Winston Logger                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LOGS       â”‚  â”‚   METRICS    â”‚
â”‚              â”‚  â”‚              â”‚
â”‚ - error.log  â”‚  â”‚ - /health    â”‚
â”‚ - combined   â”‚  â”‚ - Uptime     â”‚
â”‚   .log       â”‚  â”‚ - Response   â”‚
â”‚              â”‚  â”‚   times      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ CI/CD Pipeline (Futur)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub    â”‚
â”‚   Push      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions                 â”‚
â”‚                                 â”‚
â”‚  1. Run tests (Jest)            â”‚
â”‚  2. Lint code (ESLint)          â”‚
â”‚  3. Build Docker image          â”‚
â”‚  4. Security scan               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploy to Railway              â”‚
â”‚  - Zero downtime                â”‚
â”‚  - Auto rollback si erreur      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture validÃ©e âœ…**
**PrÃªt pour le dÃ©veloppement et dÃ©ploiement**
